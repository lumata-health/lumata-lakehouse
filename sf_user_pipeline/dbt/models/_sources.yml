# Source definitions for sf_user pipeline
# This file defines the raw Iceberg tables created by dbtHub

version: 2

sources:
  - name: sf_raw
    description: "Raw Salesforce data extracted by dbtHub and stored in Iceberg format"
    database: glue_catalog
    schema: sf_raw
    
    tables:
      - name: sf_user
        description: "Raw sf_user data from Salesforce User object"
        
        # Freshness checks
        freshness:
          warn_after: {count: 6, period: hour}
          error_after: {count: 12, period: hour}
          
        # Loaded at timestamp for freshness checks
        loaded_at_field: _extracted_at
        
        columns:
          - name: id
            description: "Salesforce User ID (Primary Key)"
            tests:
              - not_null
              - unique
              
          - name: name
            description: "User full name"
            tests:
              - not_null
              
          - name: division
            description: "User division (SCD tracked field)"
            tests:
              - accepted_values:
                  values: ['North', 'South', 'East', 'West', 'Central']
                  quote: false
                  
          - name: audit_phase__c
            description: "Custom audit phase field (SCD tracked field)"
            tests:
              - accepted_values:
                  values: ['Phase1', 'Phase2', 'Phase3', 'Complete']
                  quote: false
                  
          - name: lastmodifieddate
            description: "Record last modified timestamp"
            tests:
              - not_null
              
          - name: isactive
            description: "User active status"
            tests:
              - not_null
              - accepted_values:
                  values: [true, false]
                  
          - name: isdeleted
            description: "User deleted status"
            tests:
              - not_null
              - accepted_values:
                  values: [true, false]
                  
          - name: createddate
            description: "Record creation timestamp"
            tests:
              - not_null
              
          - name: _extracted_at
            description: "dbtHub extraction timestamp"
            tests:
              - not_null
              
          - name: _extraction_run_id
            description: "dbtHub extraction run identifier"
            tests:
              - not_null